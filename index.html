<!doctype html>
<html lang="ko">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <title>Sigmoid Trainer (A, W, b)</title>
  <style>
    :root { --gap: 10px; --cell: 64px; }
    body {
      font-family: system-ui, -apple-system, Segoe UI, Roboto, "Noto Sans KR", sans-serif;
      margin: 20px;
      line-height: 1.35;
    }
    h1 { font-size: 18px; margin: 0 0 14px; }

    .row { display: flex; gap: 24px; flex-wrap: wrap; align-items: flex-start; }
    .panel {
      border: 1px solid #ddd;
      border-radius: 12px;
      padding: 14px;
      min-width: 320px;
      background: #fff;
    }
    .panel h2 { font-size: 14px; margin: 0 0 10px; }

    .grid {
      display: grid;
      grid-template-columns: repeat(4, var(--cell));
      gap: var(--gap);
    }

    /* A buttons */
    .a-btn {
      width: var(--cell);
      height: var(--cell);
      border-radius: 12px;
      border: 1px solid #bbb;
      cursor: pointer;
      font-weight: 800;
      font-size: 16px;
      user-select: none;
      display: flex;
      align-items: center;
      justify-content: center;
      background: #f7f7f7;
      transition: transform 0.05s ease;
    }
    .a-btn:active { transform: scale(0.98); }
    .a-btn.on {
      background: #111;
      color: #fff;
      border-color: #111;
    }

    /* W sliders */
    .w-cell {
      width: var(--cell);
      height: var(--cell);
      border: 1px solid #ddd;
      border-radius: 12px;
      padding: 6px 6px 4px;
      display: flex;
      flex-direction: column;
      justify-content: space-between;
      background: #fff;
    }
    .w-val {
      font-size: 12px;
      text-align: center;
      font-variant-numeric: tabular-nums;
    }
    input[type="range"] { width: 100%; margin: 0; }

    .sub { font-size: 12px; opacity: 0.7; margin-top: 10px; }
    .mono { font-variant-numeric: tabular-nums; font-family: ui-monospace, SFMono-Regular, Menlo, Monaco, Consolas, monospace; }

    /* b slider */
    .b-wrap { margin-top: 14px; padding-top: 12px; border-top: 1px dashed #ddd; }
    .b-head { display: flex; justify-content: space-between; align-items: center; margin-bottom: 8px; }

    /* Result */
    .result-box { display: grid; gap: 10px; }
    .big { font-size: 18px; font-weight: 900; }

    /* Centered 0.5 indicator */
    .meter {
      position: relative;
      height: 22px;
      border-radius: 999px;
      border: 1px solid #ddd;
      background: linear-gradient(90deg, #f2f2f2, #fafafa);
      overflow: hidden;
    }
    .meter .mid {
      position: absolute;
      left: 50%;
      top: 0; bottom: 0;
      width: 2px;
      background: #666;
      opacity: 0.85;
    }
    .meter .dot {
      position: absolute;
      top: 50%;
      transform: translate(-50%, -50%);
      width: 14px;
      height: 14px;
      border-radius: 50%;
      background: #111;
      box-shadow: 0 0 0 3px rgba(0,0,0,0.08);
    }
    .meter-labels {
      display: flex;
      justify-content: space-between;
      font-size: 12px;
      opacity: 0.75;
    }

    .hint { font-size: 12px; opacity: 0.75; }
    .btnbar { display: flex; gap: 10px; flex-wrap: wrap; }
    button {
      border: 1px solid #ccc;
      background: #fff;
      border-radius: 10px;
      padding: 8px 10px;
      cursor: pointer;
    }
    button:active { transform: scale(0.99); }

    .train-row {
      display: flex;
      gap: 12px;
      align-items: center;
      flex-wrap: wrap;
    }
    .train-row label { font-size: 13px; }

    details > summary { list-style: none; }
    details > summary::-webkit-details-marker { display: none; }
  </style>
</head>

<body>
  <h1>Sigmoid: X = Ïƒ(Wáµ€A + b) + í•™ìŠµ(Train)</h1>

  <div class="row">
    <!-- A -->
    <section class="panel">
      <h2>A (4Ã—4) â€” í´ë¦­í•´ì„œ 0/1 í† ê¸€</h2>
      <div id="aGrid" class="grid"></div>
      <div class="sub">AëŠ” 16ì°¨ì›(4Ã—4)ì„ í¼ì¹œ ë²¡í„°ë¡œ ë‚´ë¶€ ê³„ì‚°ì— ë“¤ì–´ê°‘ë‹ˆë‹¤.</div>
      <div class="btnbar" style="margin-top:10px;">
        <button id="aAll0">A ì „ë¶€ 0</button>
        <button id="aAll1">A ì „ë¶€ 1</button>
        <button id="aChecker">ì²´ì»¤ íŒ¨í„´</button>
      </div>
    </section>

    <!-- W, b -->
    <section class="panel">
      <h2>W (4Ã—4) â€” ìŠ¬ë¼ì´ë”(ë‹¤ì´ì–¼ ëŠë‚Œ)ë¡œ ì¡°ì ˆ</h2>
      <div id="wGrid" class="grid"></div>

      <div class="b-wrap">
        <div class="b-head">
          <div><b>b</b> ë‹¤ì´ì–¼(ìŠ¬ë¼ì´ë”)</div>
          <div class="mono" id="bVal">0.00</div>
        </div>
        <input id="bSlider" type="range" min="-5" max="5" step="0.01" value="0" />
        <div class="hint">z = Î£(Wáµ¢Â·Aáµ¢) + b, X = Ïƒ(z)</div>
      </div>

      <div class="btnbar" style="margin-top:10px;">
        <button id="wZero">W ì „ë¶€ 0</button>
        <button id="wRand">W ëœë¤</button>
      </div>
    </section>

    <!-- Result + Train + Math -->
    <section class="panel" style="min-width: 360px;">
      <h2>ê²°ê³¼</h2>

      <div class="result-box">
        <div class="big">X = <span class="mono" id="xVal">0.500000</span></div>
        <div class="mono">z = <span id="zVal">0.000000</span></div>

        <div class="meter" aria-label="X meter">
          <div class="mid"></div>
          <div class="dot" id="dot"></div>
        </div>
        <div class="meter-labels">
          <span>0</span><span>0.5</span><span>1</span>
        </div>

        <div class="hint">ê²€ì€ ì ì´ 0.5 ì¤‘ì•™ì„ ì„ ê¸°ì¤€ìœ¼ë¡œ ì¢Œìš°ë¡œ ì´ë™í•©ë‹ˆë‹¤.</div>

        <!-- Train UI -->
        <div style="margin-top:14px; border-top:1px dashed #ddd; padding-top:12px;">
          <div class="train-row">
            <div><b>Target y</b>:</div>
            <label><input type="radio" name="targetY" value="0" checked> 0</label>
            <label><input type="radio" name="targetY" value="1"> 1</label>

            <div style="margin-left:10px;"><b>Î·</b>:</div>
            <input id="lrSlider" type="range" min="0.001" max="1" step="0.001" value="0.1" />
            <span class="mono" id="lrVal">0.100</span>
          </div>

          <div class="btnbar" style="margin-top:10px;">
            <button id="train1">Train 1 step</button>
            <button id="train100">Train 100 steps</button>
          </div>

          <div class="mono" style="margin-top:10px;">
            Loss (CE) = <span id="lossVal">0.693147</span>
          </div>

          <div class="hint" style="margin-top:8px;">
            í•™ìŠµì€ â€œí˜„ì¬ í™”ë©´ì˜ A í•œ ì¥â€ì„ 1ê°œ ìƒ˜í”Œë¡œ ë³´ê³ , yì— ë§ì¶”ë„ë¡ W,bë¥¼ ì—…ë°ì´íŠ¸í•©ë‹ˆë‹¤.
          </div>
        </div>

       <!-- Math Panel (more explicit, HTML-friendly) -->
        <div style="margin-top:16px; border-top:2px solid #eee; padding-top:12px;">
        <details open>
            <summary style="cursor:pointer; font-weight:800;">
            ğŸ”¢ í˜„ì¬ í”„ë¡ íŠ¸ì—”ë“œì—ì„œ ê³„ì‚° ì¤‘ì¸ ìˆ˜ì‹ (êµ¬ì²´ ë²„ì „)
            </summary>

            <div class="mono" style="margin-top:10px; font-size:13px; line-height:1.75;">
            <b>[ì…ë ¥]</b><br/>
            A âˆˆ {0,1}<sup>16</sup>,&nbsp; W âˆˆ â„<sup>16</sup>,&nbsp; b âˆˆ â„,&nbsp; y âˆˆ {0,1}<br/>
            (Aì™€ WëŠ” 4Ã—4ë¥¼ í¼ì¹œ 16ì°¨ì› ë²¡í„°, i = 1,â€¦,16)
            <br/><br/>

            <b>[Forward]</b><br/>
            z = Wáµ€A + b<br/>
            &nbsp;&nbsp;= Î£<sub>i=1</sub><sup>16</sup> W<sub>i</sub>A<sub>i</sub> + b<br/>
            X = Ïƒ(z) = 1 / (1 + e<sup>âˆ’z</sup>)
            <br/><br/>

            <b>[Loss (Binary Cross-Entropy)]</b><br/>
            L(X, y) = âˆ’[ y log(X) + (1 âˆ’ y) log(1 âˆ’ X) ]<br/>
            (logëŠ” ìì—°ë¡œê·¸ ln)
            <br/><br/>

            <b>[Gradient]</b><br/>
            (Sigmoid + CE ì¡°í•©ì—ì„œ)<br/>
            âˆ‚L/âˆ‚z = X âˆ’ y<br/>
            âˆ‚L/âˆ‚W<sub>i</sub> = (âˆ‚L/âˆ‚z)(âˆ‚z/âˆ‚W<sub>i</sub>) = (X âˆ’ y)A<sub>i</sub><br/>
            âˆ‚L/âˆ‚b = (âˆ‚L/âˆ‚z)(âˆ‚z/âˆ‚b) = (X âˆ’ y)
            <br/><br/>

            <b>[Update (Gradient Descent)]</b><br/>
            W<sub>i</sub><sup>(n)</sup> â† W<sub>i</sub><sup>(nâˆ’1)</sup> âˆ’ Î· Â· âˆ‚L/âˆ‚W<sub>i</sub><br/>
            &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;= W<sub>i</sub><sup>(nâˆ’1)</sup> âˆ’ Î· (X âˆ’ y)A<sub>i</sub><br/>
            b<sup>(n)</sup> â† b<sup>(nâˆ’1)</sup> âˆ’ Î· Â· âˆ‚L/âˆ‚b<br/>
            &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;= b<sup>(nâˆ’1)</sup> âˆ’ Î· (X âˆ’ y)
            </div>
        </details>
        </div>
      </div>
    </section>
  </div>

  <script>
    // ===== Core math =====
    function sigmoid(x) {
      const t = Math.max(-60, Math.min(60, x)); // exp overflow ë°©ì§€
      return 1 / (1 + Math.exp(-t));
    }

    // Flattened arrays (length 16)
    const A = Array(16).fill(0);
    const W = Array(16).fill(0);
    let b = 0;

    // ===== Build A grid =====
    const aGrid = document.getElementById("aGrid");
    const aButtons = [];

    for (let i = 0; i < 16; i++) {
      const btn = document.createElement("div");
      btn.className = "a-btn";
      btn.textContent = "0";
      btn.title = `A[${i}]`;

      btn.addEventListener("click", () => {
        A[i] = A[i] ? 0 : 1;
        renderAButton(i);
        computeAndRender();
        updateLoss();
      });

      aGrid.appendChild(btn);
      aButtons.push(btn);
    }

    function renderAButton(i) {
      const btn = aButtons[i];
      const on = A[i] === 1;
      btn.classList.toggle("on", on);
      btn.textContent = on ? "1" : "0";
    }

    // ===== Build W grid =====
    const wGrid = document.getElementById("wGrid");
    const wSliders = [];
    const wVals = [];

    for (let i = 0; i < 16; i++) {
      const cell = document.createElement("div");
      cell.className = "w-cell";

      const val = document.createElement("div");
      val.className = "w-val mono";
      val.textContent = "0.00";

      const slider = document.createElement("input");
      slider.type = "range";
      slider.min = "-5";
      slider.max = "5";
      slider.step = "0.01";
      slider.value = "0";
      slider.title = `W[${i}]`;

      slider.addEventListener("input", () => {
        W[i] = parseFloat(slider.value);
        val.textContent = W[i].toFixed(2);
        computeAndRender();
        updateLoss();
      });

      cell.appendChild(val);
      cell.appendChild(slider);
      wGrid.appendChild(cell);

      wSliders.push(slider);
      wVals.push(val);
    }

    // ===== b slider =====
    const bSlider = document.getElementById("bSlider");
    const bVal = document.getElementById("bVal");

    bSlider.addEventListener("input", () => {
      b = parseFloat(bSlider.value);
      bVal.textContent = b.toFixed(2);
      computeAndRender();
      updateLoss();
    });

    // ===== Result rendering =====
    const xVal = document.getElementById("xVal");
    const zVal = document.getElementById("zVal");
    const dot = document.getElementById("dot");

    function compute() {
      let z = b;
      for (let i = 0; i < 16; i++) z += W[i] * A[i];
      const x = sigmoid(z);
      return { z, x };
    }

    function computeAndRender() {
      const { z, x } = compute();
      zVal.textContent = z.toFixed(6);
      xVal.textContent = x.toFixed(6);
      dot.style.left = (x * 100) + "%";
    }

    // ===== Utility buttons =====
    document.getElementById("aAll0").addEventListener("click", () => {
      for (let i = 0; i < 16; i++) A[i] = 0;
      for (let i = 0; i < 16; i++) renderAButton(i);
      computeAndRender();
      updateLoss();
    });

    document.getElementById("aAll1").addEventListener("click", () => {
      for (let i = 0; i < 16; i++) A[i] = 1;
      for (let i = 0; i < 16; i++) renderAButton(i);
      computeAndRender();
      updateLoss();
    });

    document.getElementById("aChecker").addEventListener("click", () => {
      for (let r = 0; r < 4; r++) {
        for (let c = 0; c < 4; c++) {
          const i = r * 4 + c;
          A[i] = (r + c) % 2;
        }
      }
      for (let i = 0; i < 16; i++) renderAButton(i);
      computeAndRender();
      updateLoss();
    });

    document.getElementById("wZero").addEventListener("click", () => {
      for (let i = 0; i < 16; i++) {
        W[i] = 0;
        wSliders[i].value = "0";
        wVals[i].textContent = "0.00";
      }
      computeAndRender();
      updateLoss();
    });

    document.getElementById("wRand").addEventListener("click", () => {
      for (let i = 0; i < 16; i++) {
        const v = (Math.random() * 4 - 2); // -2..2
        W[i] = v;
        wSliders[i].value = v.toFixed(2);
        wVals[i].textContent = v.toFixed(2);
      }
      computeAndRender();
      updateLoss();
    });

    // ===== Training =====
    function getTargetY() {
      const checked = document.querySelector('input[name="targetY"]:checked');
      return checked ? parseFloat(checked.value) : 0;
    }

    const lrSlider = document.getElementById("lrSlider");
    const lrVal = document.getElementById("lrVal");
    const lossVal = document.getElementById("lossVal");

    lrSlider.addEventListener("input", () => {
      lrVal.textContent = parseFloat(lrSlider.value).toFixed(3);
    });

    // Binary cross-entropy
    function crossEntropy(y, x) {
      const eps = 1e-9;
      const p = Math.min(1 - eps, Math.max(eps, x));
      return -(y * Math.log(p) + (1 - y) * Math.log(1 - p));
    }

    function updateLoss() {
      const y = getTargetY();
      const { x } = compute();
      lossVal.textContent = crossEntropy(y, x).toFixed(6);
    }

    // One gradient descent step for logistic regression
    // Using CE loss, gradient simplifies: dL/dz = (x - y)
    function trainStep() {
      const y = getTargetY();
      const lr = parseFloat(lrSlider.value);

      const { x } = compute();
      const e = (x - y); // dL/dz

      for (let i = 0; i < 16; i++) {
        W[i] -= lr * e * A[i];  // A[i]==0ì´ë©´ ì—…ë°ì´íŠ¸ ì—†ìŒ
        wSliders[i].value = W[i].toFixed(2);
        wVals[i].textContent = W[i].toFixed(2);
      }

      b -= lr * e;
      bSlider.value = b.toFixed(2);
      bVal.textContent = b.toFixed(2);

      computeAndRender();
      updateLoss();
    }

    function trainMany(steps) {
      for (let s = 0; s < steps; s++) trainStep();
    }

    document.getElementById("train1").addEventListener("click", () => trainMany(1));
    document.getElementById("train100").addEventListener("click", () => trainMany(100));

    // y ë°”ê¾¸ë©´ loss ê°±ì‹ 
    document.querySelectorAll('input[name="targetY"]').forEach(el => {
      el.addEventListener("change", () => updateLoss());
    });

    // ===== init =====
    for (let i = 0; i < 16; i++) renderAButton(i);
    bVal.textContent = "0.00";
    lrVal.textContent = parseFloat(lrSlider.value).toFixed(3);
    computeAndRender();
    updateLoss();
  </script>
</body>
</html>
